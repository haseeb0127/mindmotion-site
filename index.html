document.getElementById('generate-btn').addEventListener('click', function() {
    const script = document.getElementById('script-input').value;
    if (!script) {
        alert("Please enter a script or notes first!");
        return;
    }

    // UI Elements
    const btn = this;
    const progressContainer = document.getElementById('progress-container');
    const progressBar = document.getElementById('progress-bar');
    const status = document.getElementById('status-display');
    const consoleBox = document.getElementById('engine-console');
    const previewBox = document.getElementById('video-preview-box');

    // 1. Reset and Show Progress
    btn.disabled = true;
    progressContainer.style.display = 'block';
    progressBar.style.width = '0%';
    status.innerText = "Initializing Swarm Engine...";
    
    let progress = 0;
    const logs = [
        "> Analyzing Psychology Script...",
        "> Extracting key semantic nodes...",
        "> Synchronizing Character: Guard HQ Bhaiya...",
        "> Rendering video frames via Swarm...",
        "> Applying brand overlays...",
        "> Finalizing MP4 Export..."
    ];

    // 2. Simulate Generation Process
    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 100) progress = 100;
        
        progressBar.style.width = progress + '%';
        
        // Update Console Logs randomly
        if (Math.random() > 0.7) {
            const randomLog = logs[Math.floor(Math.random() * logs.length)];
            consoleBox.innerHTML += `<br> ${randomLog}`;
            consoleBox.scrollTop = consoleBox.scrollHeight;
        }

        if (progress === 100) {
            clearInterval(interval);
            completeGeneration();
        }
    }, 400);

    function completeGeneration() {
        status.innerText = "âœ… Video Generated Successfully!";
        btn.disabled = false;
        previewBox.style.display = 'block';
        document.getElementById('share-hub').style.display = 'block';
        
        // Add to History
        const historyList = document.getElementById('history-list');
        const timestamp = new Date().toLocaleTimeString();
        const li = document.createElement('li');
        li.style = "padding: 10px; border-bottom: 1px solid #eee; font-size: 12px;";
        li.innerHTML = `<strong>${timestamp}</strong> - Psych Video (16:9) <a href="#" style="color:#008080; float:right;">Download</a>`;
        historyList.prepend(li);
    }
});

// Clear History Logic
document.getElementById('clear-history').addEventListener('click', () => {
    document.getElementById('history-list').innerHTML = '';
});
